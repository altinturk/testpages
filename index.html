<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Barselona Türk Rehberi</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#1f6feb;--muted:#9aa4b2}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071428 0%,#0f1724 100%);color:#e6eef8;margin:0;padding:28px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:22px}
    p.lead{margin:0;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin:18px 0}
    input.search{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
    select, button{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .card h3{margin:0 0 6px 0;font-size:16px}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .desc{font-size:14px;color:#d7e6ff;margin-bottom:8px}
    .phone{font-weight:600}
    .rating{display:inline-block;background:#0a2a16;padding:6px 8px;border-radius:999px;font-size:13px;margin-left:6px}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:22px;color:var(--muted);font-size:13px}
    .btn{cursor:pointer}
    .add-form{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;margin-top:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-top:8px}
    textarea,input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    a.link{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><rect rx='10' width='48' height='48' fill='%231f6feb'/><text x='50%' y='54%' font-size='20' text-anchor='middle' fill='white' font-family='Arial'>TR</text></svg>" alt="logo" width="48" height="48">
      <div>
        <h1>Barselona Türk Rehberi</h1>
        <p class="lead">Barselona'da yaşayan Türkler için marketler, servisler ve restoranlar — telefon, adres, tanım ve yorumlar.</p>
      </div>
    </header>

    <div class="controls">
      <input class="search" id="q" placeholder="Ara: isim, adres, ürün... (ör: İstanbul Market)" />
      <select id="categoryFilter">
        <option value="all">Tümü</option>
        <option value="market">Market / Mağaza</option>
        <option value="restaurant">Restoran / Kebab</option>
        <option value="service">Servis / Kuaför / Konsolosluk</option>
      </select>
      <button id="clear" class="btn">Filtreyi temizle</button>
    </div>

    <div id="list" class="grid"></div>

    <details open class="add-form">
      <summary class="small">Yeni bir giriş ekle (bu örnek statik - gerçek kullanım için GitHub repo'ya veri kaynağı ekleyin)</summary>
      <label>Tür:</label>
      <select id="newType"><option value="market">Market</option><option value="restaurant">Restoran</option><option value="service">Servis</option></select>
      <label>İsim</label>
      <input type="text" id="newName" />
      <label>Adres</label>
      <input type="text" id="newAddress" />
      <label>Telefon</label>
      <input type="text" id="newPhone" />
      <label>Kısa açıklama</label>
      <textarea id="newDesc" rows="3"></textarea>
      <label>Yorum / Puan (1-5)</label>
      <input type="text" id="newRating" />
      <div style="margin-top:8px"><button id="addBtn">Ekle (geçici, tarayıcıda saklanır)</button></div>
    </details>

    <footer>
      <div>Hazır örnek veriler <code>data.json</code> dosyasından yükleniyor. Kaynaklar: Instagram, TripAdvisor, resmi konsolosluk sayfaları.</div>
      <div style="margin-top:6px">Bu siteyi GitHub Pages'te yayınlamak için: yeni bir repo oluşturun <code>username.github.io</code> ve bu dosyayı <code>index.html</code>, veri dosyasını ise <code>data.json</code> olarak yükleyin.</div>
    </footer>
  </div>

  <script>
    // localStorage'dan alınan geçici eklemeler
    const saved = JSON.parse(localStorage.getItem('bcn_tr_items')||'[]');
    let data = [];

    const listEl = document.getElementById('list');
    const qEl = document.getElementById('q');
    const catEl = document.getElementById('categoryFilter');

    function render(arr){
      listEl.innerHTML='';
      if(arr.length===0){ listEl.innerHTML='<div class="small">Hiç sonuç yok.</div>'; return }
      arr.forEach(it=>{
        const div=document.createElement('div'); div.className='card';
        div.innerHTML=`<h3>${escapeHtml(it.name)} <span class="rating">${it.rating||'—'}</span></h3>
          <div class="meta">${escapeHtml(it.type)} • <span class="small">${escapeHtml(it.address)}</span></div>
          <div class="desc">${escapeHtml(it.desc)}</div>
          <div class="small">Telefon: <span class="phone">${escapeHtml(it.phone||'—')}</span> • <a class="link" href="${it.source||'#'}" target="_blank">kaynak</a></div>`;
        listEl.appendChild(div);
      })
    }

    function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

    function filterAndRender(){
      const q=qEl.value.trim().toLowerCase();
      const cat=catEl.value;
      let res = data.filter(it=>{
        if(cat!=='all' && it.type!==cat) return false;
        if(!q) return true;
        return (it.name||'').toLowerCase().includes(q) || (it.address||'').toLowerCase().includes(q) || (it.desc||'').toLowerCase().includes(q);
      });
      render(res);
    }

    qEl.addEventListener('input', filterAndRender);
    catEl.addEventListener('change', filterAndRender);
    document.getElementById('clear').addEventListener('click', ()=>{qEl.value='';catEl.value='all';filterAndRender()});

    // Geçici ekleme
    document.getElementById('addBtn').addEventListener('click', ()=>{
      const newItem = {
        id: Date.now(),
        type: document.getElementById('newType').value,
        name: document.getElementById('newName').value || 'İsim yok',
        address: document.getElementById('newAddress').value || '',
        phone: document.getElementById('newPhone').value || '',
        desc: document.getElementById('newDesc').value || '',
        rating: parseFloat(document.getElementById('newRating').value) || '—',
        source: '#'
      };
      saved.push(newItem);
      localStorage.setItem('bcn_tr_items', JSON.stringify(saved));
      data.push(newItem);
      filterAndRender();
      alert('Giriş eklendi (sadece bu tarayıcıda saklanır). Gerçek kayıt için GitHub repo verisini güncelleyin.');
    })

    // JSON'dan veri yükle
    fetch('data.json')
      .then(res => res.json())
      .then(json => {
        data = json.concat(saved);
        filterAndRender();
      })
      .catch(err => {
        console.error('data.json yüklenemedi', err);
        data = saved;
        filterAndRender();
      });

    // Basit export - JSON indir
    function downloadJSON(){
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='bcn_turk_directory.json'; document.body.appendChild(a); a.click(); a.remove();
    }

    // keyboard shortcut: Ctrl+E indir
    document.addEventListener('keydown', (e)=>{if(e.ctrlKey && e.key.toLowerCase()==='e'){downloadJSON()}})
  </script>
</body>
</html>
